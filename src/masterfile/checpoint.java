/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package masterfile;

import Main.MainControl;
import borfunction.GetComputerName;
import borfunction.btnFind;
import borfunction.settext;
import dbutility.dbUtility;
import java.awt.event.KeyEvent;
import java.io.File;
import java.io.IOException;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Calendar;
import java.util.Date;
import java.util.Locale;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.ListSelectionModel;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.JTableHeader;
import javax.swing.table.TableColumnModel;
import jxl.write.WriteException;
import net.sf.jasperreports.view.save.JRSingleSheetXlsSaveContributor;
import reportfile.rptChkpost;
import system.os.utility.ClassPath;
import utilities.DateChooser.DateUtil;
import utilititiesfunction.Export2Excel;
import utilititiesfunction.Format;
import utilititiesfunction.PUtility;
import utilititiesfunction.ThaiUtilities;

/**
 *
 * @author user
 */
public class checpoint extends javax.swing.JFrame {

    /**
     * Creates new form checkfile
     */
    ThaiUtilities cvth = new ThaiUtilities();
    btnFind btn = new btnFind();
    dbUtility db = new dbUtility();
    Statement stmt;
    int per = 0;
    DefaultTableModel model;
    private String ComName = "";
    String XBranCode1 = "";
    String XBranCode2 = "";
    String XPro1 = "";
    String XPro2 = "";
    String DataPath = "";

    public checpoint() {
        this.setExtendedState(checpoint.MAXIMIZED_BOTH);
        initComponents();
        db.dbconnect();
        ClassPath cp = new ClassPath();
        cp.ClassPath();
        DataPath = ClassPath.datapath;
        //PUtility.ShowMsg(DataPath);
        ComName = new GetComputerName().getComputerName();
        model = (DefaultTableModel) tblShow.getModel();
        tblShow.setShowGrid(true);
        tblShow.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);
        tblShow.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        tblShow.setRowSelectionAllowed(true);
        tblShow.setBackground(java.awt.Color.WHITE);
        tblShow.setGridColor(java.awt.Color.gray);

        TableColumnModel tcm = tblShow.getColumnModel();
        DefaultTableCellRenderer d;
        JTableHeader header = tblShow.getTableHeader();
        header.setFont(new java.awt.Font("Norasi", java.awt.Font.PLAIN, 14));
        tblShow.setFont(new java.awt.Font("Norasi", java.awt.Font.PLAIN, 14));
        tblShow.setRowHeight(25);
        t_date1.setText(Format.dateFmtShow.format(new java.util.Date()));
        t_date2.setText(Format.dateFmtShow.format(new java.util.Date()));
        ClearGrid();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel6 = new javax.swing.JPanel();
        jPanel8 = new javax.swing.JPanel();
        d_branch = new javax.swing.JLabel();
        t_branch1 = new javax.swing.JFormattedTextField();
        btn7 = new javax.swing.JButton();
        t_branch2 = new javax.swing.JFormattedTextField();
        btn17 = new javax.swing.JButton();
        d_branch3 = new javax.swing.JLabel();
        jPanel7 = new javax.swing.JPanel();
        btn_Calendar = new javax.swing.JButton();
        d_date3 = new javax.swing.JLabel();
        t_date1 = new javax.swing.JFormattedTextField();
        t_date2 = new javax.swing.JFormattedTextField();
        btn_Calendar1 = new javax.swing.JButton();
        d_date1 = new javax.swing.JLabel();
        db_btnProcress = new javax.swing.JButton();
        db_btnExel = new javax.swing.JButton();
        btnExit1 = new javax.swing.JButton();
        jPanel9 = new javax.swing.JPanel();
        t_plu1 = new javax.swing.JTextField();
        t_plu2 = new javax.swing.JTextField();
        d_plu3 = new javax.swing.JLabel();
        d_plu1 = new javax.swing.JLabel();
        btn4 = new javax.swing.JButton();
        btn5 = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblShow = new javax.swing.JTable();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("รายงานโปรโมชั่นรับสิทธิ์ลุ้นรางวัล");

        jPanel6.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jPanel8.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        d_branch.setFont(new java.awt.Font("Norasi", 0, 14)); // NOI18N
        d_branch.setText("กำหนดช่วงสาขา (Branch)");
        d_branch.setName("d_branch"); // NOI18N

        t_branch1.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                t_branch1FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                t_branch1FocusLost(evt);
            }
        });
        t_branch1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                t_branch1KeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                t_branch1KeyTyped(evt);
            }
        });

        btn7.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/Windows-Magnifier-icon.png"))); // NOI18N
        btn7.setFocusable(false);
        btn7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn7ActionPerformed(evt);
            }
        });

        t_branch2.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                t_branch2FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                t_branch2FocusLost(evt);
            }
        });
        t_branch2.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                t_branch2KeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                t_branch2KeyTyped(evt);
            }
        });

        btn17.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/Windows-Magnifier-icon.png"))); // NOI18N
        btn17.setFocusable(false);
        btn17.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn17ActionPerformed(evt);
            }
        });

        d_branch3.setFont(new java.awt.Font("Norasi", 0, 14)); // NOI18N
        d_branch3.setText("ถึง");
        d_branch3.setName("d_branch3"); // NOI18N

        javax.swing.GroupLayout jPanel8Layout = new javax.swing.GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(jPanel8Layout.createSequentialGroup()
                        .addComponent(t_branch1, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btn7, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(d_branch3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(t_branch2, javax.swing.GroupLayout.PREFERRED_SIZE, 41, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btn17, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(d_branch, javax.swing.GroupLayout.DEFAULT_SIZE, 196, Short.MAX_VALUE))
                .addGap(53, 53, 53))
        );
        jPanel8Layout.setVerticalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel8Layout.createSequentialGroup()
                .addGap(15, 15, 15)
                .addComponent(d_branch, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(t_branch1, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btn7, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(t_branch2, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(d_branch3, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btn17, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(26, 26, 26))
        );

        jPanel7.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        btn_Calendar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/Date-and-Time-icon .png"))); // NOI18N
        btn_Calendar.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btn_Calendar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_CalendarActionPerformed(evt);
            }
        });

        d_date3.setFont(new java.awt.Font("Norasi", 0, 14)); // NOI18N
        d_date3.setText("ถึง");
        d_date3.setName("d_date3"); // NOI18N

        t_date1.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.DateFormatter(new java.text.SimpleDateFormat("dd/MM/yyyy"))));
        t_date1.setFont(new java.awt.Font("Norasi", 0, 14)); // NOI18N
        t_date1.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                t_date1FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                t_date1FocusLost(evt);
            }
        });
        t_date1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                t_date1KeyPressed(evt);
            }
        });

        t_date2.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.DateFormatter(new java.text.SimpleDateFormat("dd/MM/yyyy"))));
        t_date2.setFont(new java.awt.Font("Norasi", 0, 14)); // NOI18N
        t_date2.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                t_date2FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                t_date2FocusLost(evt);
            }
        });
        t_date2.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                t_date2KeyPressed(evt);
            }
        });

        btn_Calendar1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/Date-and-Time-icon .png"))); // NOI18N
        btn_Calendar1.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        btn_Calendar1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btn_Calendar1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_Calendar1ActionPerformed(evt);
            }
        });

        d_date1.setFont(new java.awt.Font("Norasi", 0, 14)); // NOI18N
        d_date1.setText("กำหนดช่วงวันที่(Date)");
        d_date1.setName("d_date1"); // NOI18N

        javax.swing.GroupLayout jPanel7Layout = new javax.swing.GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel7Layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(d_date1, javax.swing.GroupLayout.PREFERRED_SIZE, 185, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(113, 113, 113))
                    .addGroup(jPanel7Layout.createSequentialGroup()
                        .addComponent(t_date1, javax.swing.GroupLayout.PREFERRED_SIZE, 77, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btn_Calendar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(d_date3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(t_date2, javax.swing.GroupLayout.PREFERRED_SIZE, 77, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btn_Calendar1, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addContainerGap())))
        );
        jPanel7Layout.setVerticalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel7Layout.createSequentialGroup()
                .addGap(12, 12, 12)
                .addComponent(d_date1, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btn_Calendar1, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(d_date3, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(t_date2, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btn_Calendar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(t_date1, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        db_btnProcress.setFont(new java.awt.Font("Norasi", 1, 14)); // NOI18N
        db_btnProcress.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/Hourglass-icon.png"))); // NOI18N
        db_btnProcress.setText("ประมวลผล");
        db_btnProcress.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        db_btnProcress.setIconTextGap(0);
        db_btnProcress.setName("db_btnProcress"); // NOI18N
        db_btnProcress.setPreferredSize(new java.awt.Dimension(67, 68));
        db_btnProcress.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        db_btnProcress.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                db_btnProcressActionPerformed(evt);
            }
        });

        db_btnExel.setFont(new java.awt.Font("Norasi", 1, 14)); // NOI18N
        db_btnExel.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/Excel-icon.png"))); // NOI18N
        db_btnExel.setText("Exel File");
        db_btnExel.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        db_btnExel.setIconTextGap(0);
        db_btnExel.setName("db_btnExel"); // NOI18N
        db_btnExel.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        db_btnExel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                db_btnExelActionPerformed(evt);
            }
        });

        btnExit1.setFont(new java.awt.Font("Norasi", 1, 14)); // NOI18N
        btnExit1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/LogOut-icon.png"))); // NOI18N
        btnExit1.setText("Exit");
        btnExit1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnExit1.setIconTextGap(0);
        btnExit1.setName("db_btnExit"); // NOI18N
        btnExit1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnExit1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnExit1ActionPerformed(evt);
            }
        });

        jPanel9.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        t_plu1.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                t_plu1FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                t_plu1FocusLost(evt);
            }
        });
        t_plu1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                t_plu1KeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                t_plu1KeyTyped(evt);
            }
        });

        t_plu2.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                t_plu2FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                t_plu2FocusLost(evt);
            }
        });
        t_plu2.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                t_plu2KeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                t_plu2KeyTyped(evt);
            }
        });

        d_plu3.setFont(new java.awt.Font("Norasi", 0, 14)); // NOI18N
        d_plu3.setText("ถึง");
        d_plu3.setName("d_plu3");

        d_plu1.setFont(new java.awt.Font("Norasi", 0, 14)); // NOI18N
        d_plu1.setText("กำหนดรหัสโปรโมชั่น");
        d_plu1.setName("d_plu1");

        btn4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/Windows-Magnifier-icon.png"))); // NOI18N
        btn4.setFocusable(false);
        btn4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn4ActionPerformed(evt);
            }
        });

        btn5.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/Windows-Magnifier-icon.png"))); // NOI18N
        btn5.setFocusable(false);
        btn5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn5ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel9Layout = new javax.swing.GroupLayout(jPanel9);
        jPanel9.setLayout(jPanel9Layout);
        jPanel9Layout.setHorizontalGroup(
            jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel9Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel9Layout.createSequentialGroup()
                        .addComponent(t_plu1, javax.swing.GroupLayout.PREFERRED_SIZE, 37, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btn5, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(d_plu3, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(2, 2, 2)
                        .addComponent(t_plu2, javax.swing.GroupLayout.PREFERRED_SIZE, 36, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btn4, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(d_plu1, javax.swing.GroupLayout.PREFERRED_SIZE, 182, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel9Layout.setVerticalGroup(
            jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel9Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(d_plu1)
                .addGap(0, 0, Short.MAX_VALUE)
                .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(t_plu1, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(d_plu3, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(t_plu2, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btn4, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btn5, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addComponent(jPanel7, javax.swing.GroupLayout.PREFERRED_SIZE, 282, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel8, javax.swing.GroupLayout.PREFERRED_SIZE, 212, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel9, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(db_btnProcress, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(db_btnExel, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(btnExit1, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel7, javax.swing.GroupLayout.DEFAULT_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jPanel8, javax.swing.GroupLayout.PREFERRED_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(0, 0, Short.MAX_VALUE))
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jPanel9, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel6Layout.createSequentialGroup()
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(btnExit1, javax.swing.GroupLayout.PREFERRED_SIZE, 67, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(db_btnExel, javax.swing.GroupLayout.PREFERRED_SIZE, 67, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(db_btnProcress, javax.swing.GroupLayout.PREFERRED_SIZE, 67, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addGap(29, 29, 29))
        );

        tblShow.setAutoCreateRowSorter(true);
        tblShow.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null}
            },
            new String [] {
                "Branch", "Promotion", "NO", "Date", "Receipt NO#", "N.Right", "Time", "Cashier"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.Integer.class, java.lang.String.class, java.lang.String.class, java.lang.Integer.class, java.lang.String.class, java.lang.String.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblShow.setRowHeight(25);
        jScrollPane1.setViewportView(tblShow);
        tblShow.getColumnModel().getColumn(0).setPreferredWidth(200);
        tblShow.getColumnModel().getColumn(1).setPreferredWidth(200);
        tblShow.getColumnModel().getColumn(2).setPreferredWidth(50);
        tblShow.getColumnModel().getColumn(3).setPreferredWidth(100);
        tblShow.getColumnModel().getColumn(4).setPreferredWidth(120);
        tblShow.getColumnModel().getColumn(5).setPreferredWidth(100);
        tblShow.getColumnModel().getColumn(6).setPreferredWidth(80);
        tblShow.getColumnModel().getColumn(7).setPreferredWidth(80);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jScrollPane1)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, 101, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 566, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 67, Short.MAX_VALUE))
        );

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-1024)/2, (screenSize.height-768)/2, 1024, 768);
    }// </editor-fold>//GEN-END:initComponents

    private void btn_CalendarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_CalendarActionPerformed
        //btn.btncalendar2(t_date1);
        DateUtil.showDateChooserDialog(t_date1, btn_Calendar);
        t_date1.requestFocus();
        // TODO add your handling code here:
    }//GEN-LAST:event_btn_CalendarActionPerformed

    private void t_date1FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_date1FocusGained
        t_date1.setText(t_date1.getText());
        t_date1.selectAll();
        // TODO add your handling code here:
    }//GEN-LAST:event_t_date1FocusGained

    private void t_date1FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_date1FocusLost
        t_date1.select(0, 0);
        if (t_date1.getText().equals("")) {
            t_date1.setText(Format.dateFmtShow.format(new java.util.Date()));
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_t_date1FocusLost

    private void t_date1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_date1KeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_F1) {
            DateUtil.showDateChooserDialog(t_date1, btn_Calendar);
            t_date1.requestFocus();
        } else if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            t_date2.requestFocus();
        } else if (evt.getKeyCode() == KeyEvent.VK_F5) {
            btnProcessClick();
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_t_date1KeyPressed

    private void t_date2FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_date2FocusGained
        t_date2.setText(t_date2.getText());
        t_date2.selectAll();
        // TODO add your handling code here:
    }//GEN-LAST:event_t_date2FocusGained

    private void t_date2FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_date2FocusLost
        t_date2.select(0, 0);
        if (t_date2.getText().equals("")) {
            t_date2.setText(Format.dateFmtShow.format(new java.util.Date()));
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_t_date2FocusLost

    private void t_date2KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_date2KeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_F1) {
            DateUtil.showDateChooserDialog(t_date2, btn_Calendar1);
            t_date2.requestFocus();
        } else if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            t_branch1.requestFocus();
        } else if (evt.getKeyCode() == KeyEvent.VK_F5) {
            btnProcessClick();
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_t_date2KeyPressed

    private void btn_Calendar1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_Calendar1ActionPerformed
        //btn.btncalendar2(t_date2);
        DateUtil.showDateChooserDialog(t_date2, btn_Calendar1);
        t_date2.requestFocus();
        // TODO add your handling code here:
    }//GEN-LAST:event_btn_Calendar1ActionPerformed

    private void t_branch1FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_branch1FocusGained
        t_branch1.setText(t_branch1.getText());
        t_branch1.selectAll();
        // TODO add your handling code here:
    }//GEN-LAST:event_t_branch1FocusGained

    private void t_branch1FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_branch1FocusLost
        t_branch1.select(0, 0);
        // TODO add your handling code here:
    }//GEN-LAST:event_t_branch1FocusLost

    private void t_branch1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_branch1KeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            t_branch2.requestFocus();
        } else if (evt.getKeyCode() == KeyEvent.VK_F1) {
            btn.btnFindBranch(t_branch1);
        } else if (evt.getKeyCode() == KeyEvent.VK_F5) {
            btnProcessClick();
        }

        // TODO add your handling code here:
    }//GEN-LAST:event_t_branch1KeyPressed

    private void t_branch1KeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_branch1KeyTyped
        settext.setTextLength(evt, t_branch1, 12);
        // TODO add your handling code here:
    }//GEN-LAST:event_t_branch1KeyTyped

    private void btn7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn7ActionPerformed
        btn.btnFindBranch(t_branch1);
        // TODO add your handling code here:
    }//GEN-LAST:event_btn7ActionPerformed

    private void t_branch2FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_branch2FocusGained
        t_branch2.setText(t_branch2.getText());
        t_branch2.selectAll();
        // TODO add your handling code here:
    }//GEN-LAST:event_t_branch2FocusGained

    private void t_branch2FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_branch2FocusLost
        t_branch2.select(0, 0);
        // TODO add your handling code here:
    }//GEN-LAST:event_t_branch2FocusLost

    private void t_branch2KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_branch2KeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            t_date1.requestFocus();
        } else if (evt.getKeyCode() == KeyEvent.VK_F1) {
            btn.btnFindBranch(t_branch2);
        } else if (evt.getKeyCode() == KeyEvent.VK_F5) {
            btnProcessClick();
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_t_branch2KeyPressed

    private void t_branch2KeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_branch2KeyTyped
        settext.setTextLength(evt, t_branch2, 12);
        // TODO add your handling code here:
    }//GEN-LAST:event_t_branch2KeyTyped

    private void btn17ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn17ActionPerformed
        btn.btnFindBranch(t_branch2);
        // TODO add your handling code here:
    }//GEN-LAST:event_btn17ActionPerformed

    private void db_btnProcressActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_db_btnProcressActionPerformed
        btnProcessClick();
    }//GEN-LAST:event_db_btnProcressActionPerformed

    private void db_btnExelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_db_btnExelActionPerformed

        Export2Excel test = new Export2Excel();
        JFileChooser chooser = new JFileChooser();


        chooser.setSelectedFile(test.getDefaulepath());
        chooser.setFileFilter(new JRSingleSheetXlsSaveContributor(Locale.ENGLISH, null));

        int confirm = chooser.showSaveDialog(this);
        if (confirm == JFileChooser.APPROVE_OPTION) {

            File curFile = chooser.getSelectedFile();

            if (curFile.exists()) {
                int confirm2 = JOptionPane.showConfirmDialog(this, "ข้อมูลนี้มีอยู่แล้ว คุณต้องการบันทึกรายการนี้หรือไม่...?", "Confirm", JOptionPane.YES_NO_OPTION);
                if (confirm2 == JOptionPane.NO_OPTION) {
                    test.setDefaultpath(curFile);
                    db_btnExelActionPerformed(null);

                    return;

                }
            }
            DefaultTableModel dtb;
            JTableHeader jtb;
            dtb = (DefaultTableModel) tblShow.getModel();
            jtb = tblShow.getTableHeader();
            try {
                test.setOutputFile(curFile.toString());
                test.write2single(dtb, jtb);
                test.setDefaultpath(curFile);
            } catch (IOException ex) {
                JOptionPane.showMessageDialog(this, ex);
            } catch (WriteException ex) {
                JOptionPane.showMessageDialog(this, ex);
            }
        }
    }//GEN-LAST:event_db_btnExelActionPerformed

    private void btnExit1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnExit1ActionPerformed
        this.dispose();
        // TODO add your handling code here:
    }//GEN-LAST:event_btnExit1ActionPerformed

    private void t_plu1FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_plu1FocusGained
        t_plu1.setText(t_plu1.getText());
        t_plu1.selectAll();
        // TODO add your handling code here:
    }//GEN-LAST:event_t_plu1FocusGained

    private void t_plu1FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_plu1FocusLost
        t_plu1.select(0, 0);
        // TODO add your handling code here:
    }//GEN-LAST:event_t_plu1FocusLost

    private void t_plu1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_plu1KeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            t_plu2.requestFocus();
        } else if (evt.getKeyCode() == KeyEvent.VK_F1) {
            btn.btnFindCupon(t_plu1);
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_t_plu1KeyPressed

    private void t_plu1KeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_plu1KeyTyped
        settext.setTextLength(evt, t_plu1, 13);
        // TODO add your handling code here:
    }//GEN-LAST:event_t_plu1KeyTyped

    private void t_plu2FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_plu2FocusGained
        t_plu2.setText(t_plu2.getText());
        t_plu2.selectAll();
        // TODO add your handling code here:
    }//GEN-LAST:event_t_plu2FocusGained

    private void t_plu2FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_plu2FocusLost
        t_plu2.select(0, 0);
        // TODO add your handling code here:
    }//GEN-LAST:event_t_plu2FocusLost

    private void t_plu2KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_plu2KeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            t_branch1.requestFocus();
        } else if (evt.getKeyCode() == KeyEvent.VK_F1) {
            btn.btnFindCupon(t_plu2);
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_t_plu2KeyPressed

    private void t_plu2KeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_plu2KeyTyped
        settext.setTextLength(evt, t_plu2, 13);
        // TODO add your handling code here:
    }//GEN-LAST:event_t_plu2KeyTyped

    private void btn4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn4ActionPerformed
        btn.btnFindCupon(t_plu2);
        // TODO add your handling code here:
    }//GEN-LAST:event_btn4ActionPerformed

    private void btn5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn5ActionPerformed
        btn.btnFindCupon(t_plu1);
        // TODO add your handling code here:
    }//GEN-LAST:event_btn5ActionPerformed
    private void ClearGrid() {
        int size = tblShow.getRowCount();
        if (size > 0) {
            for (int i = 0; i < size; i++) {
                model.removeRow(0);
            }
        }
    }

    private void LoadDataToGrid() {
        XBranCode1 = t_branch1.getText();
        if (t_branch2.getText().equals("")) {
            XBranCode2 = "ZZZZ";
        } else {
            XBranCode2 = t_branch2.getText();
        }
        XPro1 = t_plu1.getText();
        if (t_plu2.getText().equals("")) {
            XPro2 = "ZZZZ";
        } else {
            XPro2 = t_plu2.getText();
        }
        Calendar date1 = Calendar.getInstance() ;
        Calendar date2 = Calendar.getInstance() ;
        date1 = PUtility.StrToCalendar(t_date1.getText()) ;
        date2 = PUtility.StrToCalendar(t_date2.getText()) ;
        int cnt = 0;

        ClearGrid();
        try {
            String sql = "";
            stmt = (Statement) dbUtility.con.createStatement();
            sql = "select s_bran,s_date,saledate,cucode,receipt,numberofright,saletime,cashier,"
                    + "CONCAT(s_bran,' ',branfile.name) as branch,CONCAT(cucode,' ',proname) as promotion "
                    + "from s_point "
                    + "left join branfile on s_bran=code "
                    + "left join propoint on procode=cucode "
                    + "where s_date>='"+Format.dateFmtSql.format(date1.getTime())+"' and s_date<='"+Format.dateFmtSql.format(date2.getTime())+"' "
                    + "and s_bran>='"+XBranCode1+"' and s_bran <='"+XBranCode2+"' "
                    + "and cucode>='"+XPro1+"' and cucode <= '"+XPro2+"' "
                    + "order by s_bran,cucode,s_date,receipt";
            ResultSet rs = stmt.executeQuery(sql);  
            while (rs.next()) {
                {
                    cnt=cnt+1;
                    if (!dbUtility.Char_Set.equalsIgnoreCase("utf-8")) {
                        model.addRow(new Object[]{
                                    cvth.ASCII2Unicode(rs.getString("branch")),
                                    cvth.ASCII2Unicode(rs.getString("promotion")),
                                    cnt,  
                                    cvth.ASCII2Unicode(Format.dateFmtShow.format(rs.getDate("s_date"))),
                                    cvth.ASCII2Unicode(rs.getString("receipt")),
                                    rs.getInt("numberofright"),
                                    cvth.ASCII2Unicode(rs.getString("saletime")),
                                    cvth.ASCII2Unicode(rs.getString("cashier"))});

                    } else {
                        model.addRow(new Object[]{
                                    rs.getString("branch"),
                                    rs.getString("promotion"),
                                    cnt,
                                    Format.dateFmtShow.format(rs.getDate("s_date")),
                                    rs.getString("receipt"),
                                    rs.getInt("numberofright"),
                                    rs.getString("saletime"),
                                    rs.getString("cashier")});
                    }
                }
            }
        } catch (Exception e) {
            PUtility.ShowMsg(e.getMessage().toString());
        }
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /*
         * Set the Nimbus look and feel
         */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /*
         * If Nimbus (introduced in Java SE 6) is not available, stay with the
         * default look and feel. For details see
         * http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(checpoint.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(checpoint.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(checpoint.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(checpoint.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /*
         * Create and display the form
         */
        java.awt.EventQueue.invokeLater(new Runnable() {

            public void run() {
                new checpoint().setVisible(true);
            }
        });
    }

    public void btnProcessClick() {
        //PUtility.ShowMsg("Start Process");
        LoadDataToGrid();
    }

    public int getBranchcount(String Bran1, String Bran2) {
        int ReturnVal = 0;
        try {
            ResultSet rs = null;
            stmt = (Statement) dbUtility.con.createStatement();
            String sql = "select count(code) as count from branfile where code>='" + Bran1 + "' and code<='" + Bran2 + "' order by code";
            rs = stmt.executeQuery(sql);
            if (rs.next()) {
                ReturnVal = rs.getInt("count");
            }

        } catch (SQLException ex) {
            Logger.getLogger(rptChkpost.class.getName()).log(Level.SEVERE, null, ex);
        }
        return ReturnVal;
    }

    public String GetDataZipFileName(String fBran, String ftype, Date fdate) {
        String ReturnVal = "";
        ReturnVal = DataPath + "/b" + fBran + "/" + fBran + "_" + ftype + "_" + Format.dateText.format(fdate) + ".zip";
        return ReturnVal;
    }

    public String GetDataFileName(String fBran, String ftype, Date fdate) {
        String ReturnVal = "";
        ReturnVal = DataPath + "/b" + fBran + "/" + ftype + "_" + Format.dateTextShort.format(fdate) + ".fbran";
        return ReturnVal;
    }

    public void deletetempchkpost() {
        try {
            stmt = (Statement) db.con.createStatement();
            String sql = "Delete from tempchkpost where comname=?";
            PreparedStatement prm = (PreparedStatement) db.con.prepareStatement(sql);
            prm.setString(1, ComName);
            prm.executeUpdate();
            stmt.close();
        } catch (Exception e) {
            PUtility.ShowMsg(e.getMessage().toString());
        }
    }

    public String ChkFileZip(String fBran, String ftype, Date fdate) {
        String ReturnVal = "";
        String FileName = GetDataZipFileName(fBran, ftype, fdate);
        File afile = new File(FileName);
        if (afile.exists()) {
            ReturnVal = "Y";
        } else {
            ReturnVal = "-";
        }
        return ReturnVal;
    }

    public String ChkFile(String fBran, String ftype, Date fdate) {
        String ReturnVal = "";
        String FileName = GetDataFileName(fBran, ftype, fdate);
        File afile = new File(FileName);
        if (afile.exists()) {
            ReturnVal = "Y";
        } else {
            ReturnVal = "-";
        }
        return ReturnVal;
    }

    public void SetTemp() {
        deletetempchkpost();
        try {
            ResultSet rs = null;
            String date1, date2;
            if (!t_date1.getText().trim().equals("")) {
                date1 = t_date1.getText();
            } else {
                date1 = "";
            }

            if (!t_date2.getText().trim().equals("")) {
                date2 = t_date2.getText();
            } else {
                date2 = Format.dateFmtShow.format(new java.util.Date());
            }
            int totaldate = DateUtil.getDate(date1, date2) + 1;
            stmt = (Statement) dbUtility.con.createStatement();
            String sql = "select * from branfile where code>='" + cvth.Unicode2ASCII(XBranCode1) + "' and code<='" + cvth.Unicode2ASCII(XBranCode2) + "' order by code";
            rs = stmt.executeQuery(sql);
            while (rs.next()) {
                String brancode = rs.getString("code");
                String branname = rs.getString("name");
                String comname = new GetComputerName().getComputerName();
                Date d1 = null;
                Date d2 = null;
                if (!date1.equals("")) {
                    d1 = Format.dateFmtShow.parse(date1);
                }
                if (!date2.equals("")) {
                    d2 = Format.dateFmtShow.parse(date2);
                }
                Statement stmt2 = (Statement) dbUtility.con.createStatement();
                while (d1.compareTo(d2) <= 0) {
                    String tempdate = Format.dateFmtSql.format(d1);
                    String bcode = brancode,
                            bname = branname;
                    String sqlinsert = "insert into tempchkpost(Comname,TDate,BrCode,BrName,DZip,Plu,"
                            + "Terminal,Cashier,Cupon,Inv,Hour,Rj,Stc,Bg,Ba,Cr,Mem,UserPost,KicTran,Charge,BI)"
                            + "values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
                    PreparedStatement prm = (PreparedStatement) db.con.prepareStatement(sqlinsert);
                    prm.setString(1, comname);
                    prm.setString(2, tempdate);
                    prm.setString(3, bcode);
                    prm.setString(4, bname);
                    prm.setString(5, ChkFileZip(bcode, "DAI", d1));
                    prm.setString(6, ChkFile(bcode, "P", d1));
                    prm.setString(7, ChkFile(bcode, "T", d1));
                    prm.setString(8, ChkFile(bcode, "C", d1));
                    prm.setString(9, ChkFile(bcode, "CU", d1));
                    prm.setString(10, ChkFile(bcode, "I", d1));
                    prm.setString(11, ChkFile(bcode, "H", d1));
                    prm.setString(12, ChkFile(bcode, "RJ", d1));
                    prm.setString(13, ChkFile(bcode, "ST", d1));
                    prm.setString(14, ChkFile(bcode, "BG", d1));
                    prm.setString(15, ChkFile(bcode, "BA", d1));
                    prm.setString(16, ChkFile(bcode, "CR", d1));
                    prm.setString(17, ChkFile(bcode, "M", d1));
                    prm.setString(18, "-");
                    prm.setString(19, ChkFile(bcode, "S_Kictran", d1));
                    prm.setString(20, ChkFile(bcode, "S_Charge", d1));
                    prm.setString(21, "-");
                    prm.executeUpdate();
                    d1 = DateUtil.addDate(d1, 1);
                }

            }
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, e);
        }

    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn17;
    private javax.swing.JButton btn4;
    private javax.swing.JButton btn5;
    private javax.swing.JButton btn7;
    private javax.swing.JButton btnExit1;
    private javax.swing.JButton btn_Calendar;
    private javax.swing.JButton btn_Calendar1;
    private javax.swing.JLabel d_branch;
    private javax.swing.JLabel d_branch3;
    private javax.swing.JLabel d_date1;
    private javax.swing.JLabel d_date3;
    private javax.swing.JLabel d_plu1;
    private javax.swing.JLabel d_plu3;
    private javax.swing.JButton db_btnExel;
    private javax.swing.JButton db_btnProcress;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JFormattedTextField t_branch1;
    private javax.swing.JFormattedTextField t_branch2;
    private javax.swing.JFormattedTextField t_date1;
    private javax.swing.JFormattedTextField t_date2;
    private javax.swing.JTextField t_plu1;
    private javax.swing.JTextField t_plu2;
    private javax.swing.JTable tblShow;
    // End of variables declaration//GEN-END:variables
}
